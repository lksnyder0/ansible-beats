---
- name: "Enable {{ beat_module_info.name }} for beat {{ beat_name }}"
  shell: "{{ beat_name }} modules enable {{ beat_module_info.name }}"
  notify: "restart {{ beat_name }}"

- name: Copy custom module config
  copy:
    dest: "/etc/{{ beat_name }}/modules.d/{{ beat_module_info.name }}.yml" # required. Remote absolute path where the file should be copied to. If I(src) is a directory, this must be a directory too. If I(dest) is a nonexistent path and if either I(dest) ends with "/" or I(src) is a directory, I(dest) is created. If I(src) and I(dest) are files, the parent directory of I(dest) isn't created: the task fails if it doesn't already exist.
    src: "{{ beat_module_info.config }}" # not required. Local path to a file to copy to the remote server; can be absolute or relative. If path is a directory, it is copied recursively. In this case, if path ends with "/", only inside contents of that directory are copied to destination. Otherwise, if it does not end with "/", the directory itself with all contents is copied. This behavior is similar to Rsync.
    group: "{{ beat_group }}" # not required. Name of the group that should own the file/directory, as would be fed to I(chown).
    mode: "{{ beat_config_mode }}" # not required. Mode the file or directory should be. For those used to I(/usr/bin/chmod) remember that modes are actually octal numbers. You must either add a leading zero so that Ansible's YAML parser knows it is an octal number (like C(0644) or C(01777)) or quote it (like C('644') or C('1777')) so Ansible receives a string and can do its own conversion from string into number.  Giving Ansible a number without following one of these rules will end up with a decimal number which will have unexpected results.  As of version 1.8, the mode may be specified as a symbolic mode (for example, C(u+rwx) or C(u=rw,g=r,o=r)).  As of version 2.3, the mode may also be the special string C(preserve).  C(preserve) means that the file will be given the same permissions as the source file.
    owner: "{{ beat_user }}" # not required. Name of the user that should own the file/directory, as would be fed to I(chown).
  when: beat_module_info.config is defined

- name: Copy default module config
  copy:
    dest: "/etc/{{ beat_name }}/modules.d/{{ beat_module_info.name }}.yml" # required. Remote absolute path where the file should be copied to. If I(src) is a directory, this must be a directory too. If I(dest) is a nonexistent path and if either I(dest) ends with "/" or I(src) is a directory, I(dest) is created. If I(src) and I(dest) are files, the parent directory of I(dest) isn't created: the task fails if it doesn't already exist.
    src: "module_config/{{ beat_name }}/{{ beat_module_info.name }}.yml" # not required. Local path to a file to copy to the remote server; can be absolute or relative. If path is a directory, it is copied recursively. In this case, if path ends with "/", only inside contents of that directory are copied to destination. Otherwise, if it does not end with "/", the directory itself with all contents is copied. This behavior is similar to Rsync.
    group: "{{ beat_group }}" # not required. Name of the group that should own the file/directory, as would be fed to I(chown).
    mode: "{{ beat_config_mode }}" # not required. Mode the file or directory should be. For those used to I(/usr/bin/chmod) remember that modes are actually octal numbers. You must either add a leading zero so that Ansible's YAML parser knows it is an octal number (like C(0644) or C(01777)) or quote it (like C('644') or C('1777')) so Ansible receives a string and can do its own conversion from string into number.  Giving Ansible a number without following one of these rules will end up with a decimal number which will have unexpected results.  As of version 1.8, the mode may be specified as a symbolic mode (for example, C(u+rwx) or C(u=rw,g=r,o=r)).  As of version 2.3, the mode may also be the special string C(preserve).  C(preserve) means that the file will be given the same permissions as the source file.
    owner: "{{ beat_user }}" # not required. Name of the user that should own the file/directory, as would be fed to I(chown).
  when: beat_module_info.config is undefined